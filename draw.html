<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<script type="text/javascript" src="js/jquery-1.12.4.js"></script>
<script type="text/javascript" src="js/jcanvas.js"></script>
<script type="text/javascript" src="js/jquery.easyui.min.js"></script>
<script type="text/javascript" src="js/easyui-lang-zh_TW.js"></script>
<style>
    #P2{
        position:absolute;
        top:11px;
        left:95px;
    }
</style>
</head>
<body>
    <table>
        <tr>
            <td width="80">
                <table style="border:1px #cccccc solid;" cellpadding="1" border='1'>
                    <tr>
                        <td>
                            <div id="red" style="background-color:#FF0000;width:30px;height:30px" onclick="paintColor=this.style.backgroundColor"></div>
                        </td>
                        <td>
                            <div id="yellow" style="background-color:#FFFF00;width:30px;height:30px" onclick="paintColor=this.style.backgroundColor"></div>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <div id="mediumblue" style="background-color:#0000CD;width:30px;height:30px" onclick="paintColor=this.style.backgroundColor"></div>
                        </td>
                        <td>
                            <div id="black" style="background-color:#000000;width:30px;height:30px" onclick="paintColor=this.style.backgroundColor"></div>
                        </td>
                    </tr>
                    <tr>
                        <td colspan="2" align="center">
                            <div id="circle3" style="width:60px;height:13px;" onclick="paintWidth=this.id.match(/\d+/)">
                                <div style="background-color:#000000;width:3px;height:3px;border-radius:999em;"></div>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td colspan="2" align="center">
                            <div id="circle6" style="width:60px;height:13px;" onclick="paintWidth=this.id.match(/\d+/)">
                                <div style="background-color:#000000;width:6px;height:6px;border-radius:999em;"></div>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td colspan="2" align="center">
                            <div id="circle9" style="width:60px;height:13px;" onclick="paintWidth=this.id.match(/\d+/)">
                                <div style="background-color:#000000;width:9px;height:9px;border-radius:999em;"></div>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td colspan="2" align="center">
                            <div>
                                <img src="css/icons/mouse-pointer.png" onclick="paintType='cursor'"/>
                            </div>
                            <div>
                                <img src="css/icons/edit.png" onclick="paintType='pen'"/>
                            </div>
                            <div>
                                <img src="css/icons/eraser.png" onclick="paintType='eraser'"/>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td colspan="2" align="center">
                            <button onclick="out()">輸出</button>
                        </td>
                    </tr>
                </table>
            </td>
            <td>
                <div id="P1">
                    <canvas id="myCanvas2" width="800" height="400" style="border:1px solid #000000;"></canvas>

                </div>
                <div id="P2">
                    <canvas id="myCanvas"  width="800" height="400"  style="border:1px solid #000000;"/>
                </div>
            </td>
        </tr>

    </table>
</body>
</html>
<script type="text/javascript">
    var isMouseDown = false;
    var pos = {
        x: 0,
        y: 0
    };
    var lastPos = {
        x: 0,
        y: 0
    };
    var paintWidth = 30; //預設畫筆寬度
    var paintColor = '#FF0000'; //預設畫筆顏色
    var paintType = 'pen'; //預設游標 eraser pen

    alert("P1 top = " + $("#P1").position().top + ", left = " + $("#P1").position().left);
    var $myCanvas = $('#myCanvas');
    var $myCanvas2 = $('#myCanvas2');
    var $offset = $myCanvas.offset();

    var itemDesc = "繼上週簽下新秀巴格利（Marvin Bagley III），彪馬（Puma）再次簽下19歲的美國大專男子錦標賽（NCAA）\n一級名校新秀艾頓（DeAndre Ayton）為彪馬代言，雙方同意4年合約，據悉金額上看台幣上億，近期推出2雙彪馬專屬籃球鞋。"
    var iDescFontSize = 20;
    //文字內距
    var wordPadding = {
        top: 10,
        right: 10,
        bottom: 10,
        left: 10
    };
    //itemDesc長度
    var iDescW = 400;
    //計算文字高度

    //表格基點
    var baseX = 30;
    var baseY = 100;
    //表格高度
    var baseH = 80;

    //答案選項長度
    var optW = 80;
    var optCnt = 3; //級分數量

    //文字畫點
    var wordPointX = 0;
    var wordPointY = 0;


    for (var item = 0; item < 2; item++)
    {
        //畫點
        var drawPointX = baseX;
        var drawPointY;
        var diffH;
        if (item == 0)
            drawPointY = baseY;
        else
            drawPointY += baseH + diffH;

        diffH = 0;

        //項目文字
        var param = {
            fillStyle: '#000',
            strokeWidth: 1,
            x: drawPointX + wordPadding.top, y: drawPointY + wordPadding.left,
            fontSize: iDescFontSize,
            fontFamily: 'Trebuchet MS, sans-serif',
            maxWidth: iDescW - wordPadding.left - wordPadding.right,
            fromCenter: false,
            align: 'left',
            text: itemDesc
        };

        var iDescParams = $myCanvas2.measureText(param);
        $myCanvas2.drawText(param);

        if (iDescParams.height + wordPadding.top + wordPadding.bottom > baseH)
            diffH = iDescParams.height + wordPadding.top + wordPadding.bottom - baseH;

        $myCanvas2.drawRect({
            strokeStyle: 'black',
            strokeWidth: 1,
            x: drawPointX, y: drawPointY,
            fromCenter: false,
            width: iDescW,
            height: baseH + diffH
        });

        drawPointX += iDescW;
        for (var cnt = 0; cnt < optCnt; cnt++)
        {
            $myCanvas2.drawRect({
                strokeStyle: 'black',
                strokeWidth: 1,
                x: drawPointX, y: drawPointY,
                fromCenter: false,
                width: optW,
                height: baseH + diffH
            });
            drawPointX += optW;
        }

    }

    function clearLine(x1, y1, x2, y2) {
/*
        $myCanvas.clearCanvas({
            x: x1, y: y1,
            radius: 10
        });
*/
        var asin = 10*Math.sin(Math.atan((y2-y1)/(x2-x1)));
        var acos = 10*Math.cos(Math.atan((y2-y1)/(x2-x1)))
        var x3 = x1+asin;
        var y3 = y1-acos;
        var x4 = x1-asin;
        var y4 = y1+acos;
        var x5 = x2+asin;
        var y5 = y2-acos;
        var x6 = x2-asin;
        var y6 = y2+acos;
/*
        $myCanvas.clearCanvas({
            x: x2, y: y2,
            radius: 10
        });
*/
        $myCanvas.clearCanvas({
            x3: 300, y3: 150,
            x4: 350, y4: 150,
            x5: 300, y5: 200,
            x6: 350, y6: 200,
            radius: 10
        });
    }

    function paintLine(x1, y1, x2, y2) {
        $myCanvas.drawLine({
            strokeStyle: paintColor,
            strokeWidth: paintWidth,
            rounded: true,
            strokeJoin: 'round',
            strokeCap: 'round',
            x1: x1,
            y1: y1,
            x2: x2,
            y2: y2
        });
    }

    //On mousedown the painting functionality kicks in
    $myCanvas.on('mousedown', function(e) {
        isMouseDown = true;
    });

    //On mouseup the painting functionality stops
    $myCanvas.on('mouseup', function() {
        isMouseDown = false;
        return;
    });

    //On mousemove store the mouse coordinates and
    //use jCanvas drawLine() method
    $myCanvas.on('mousemove', function(e) {
        lastPos.x = pos.x;
        lastPos.y = pos.y;
        pos.x = e.pageX - $offset.left;
        pos.y = e.pageY - $offset.top;
        if (isMouseDown) {
            if (paintType === 'pen')
                paintLine(lastPos.x, lastPos.y, pos.x, pos.y);
            else if (paintType === 'eraser')
                clearLine(lastPos.x, lastPos.y, pos.x, pos.y);
        }
    });
</script>
<style>
canvas {
    /**
     * Set transparent to let any other canvases render through
     */
    background-color: transparent;
}
</style>